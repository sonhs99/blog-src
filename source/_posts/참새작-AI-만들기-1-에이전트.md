---
title: 참새작 AI 만들기 1 - 에이전트
toc: true
date: 2022-03-20 10:32:53
tags: [SuzumeAI, AI, Reinforcement Learning]
categories: [AI, Reinforcement Learning]
---

참새작에서 구현할 에이전트(Agent)는 다음과 같다.

* RandomAgent : 현재 가능한 행동(Action)을 무작위로 선택하는 에이전트. 비교군
* OpenAgent : 모든 플레이어의 패와 버린 패를 확인하여 행동(Action)을 선택하는 에이전트.
* ClosedAgent : 자기 패와 모든 플레이어의 버린 패만을 확인하여 행동(Action)을 선택하는 에이전트.

## Monte Carlo?
몬테 카를로 방법은 꽤 좋은 방법이다. 많은 사람들에게 충격을 준 AlphaGo와 AlphaGo Zero는 더 좋은 수를 얻기 위해 몬테 카를로 트리 탐색을 사용하였다. 그러나 바둑과 마작은 다르다.

바둑은 상태가 모든 플레이어에게 **공개**되어있다. 바둑판의 일부를 못본다거나, 상대방의 돌의 일부를 보지 못하는 경우는 없다. 그러나 마작은 자신의 패와 모든 플레이어의 버린 패만을 확인할 수 있다. 그러므로 상대방이 어떤 행동을 할지 모른다. 상대방이 5를 버릴 것이라고 확신할 수 있는가? 설령 자신이 치트를 써서 상대방의 패를 모두 확인할 수 있다고 해도, 다음 '쯔모'하는 패는 확인할 수 없다. (쯔모 순서를 Agent에 알려줘 다음 상태를 '완벽히' 예측할 수 있도록 설계할 수 있으나, 너무 많은 정보를 준다고 생각하여 기각하였다.) 그러므로 몬테 카를로 방법을 마작에 적용하기 어렵다.

## Open, 그 다음 Closed
인터넷을 탐색하던 중 MS의 Suphx에 대하여 알게 되었다. Suphx는 일본/중국 마작을 할 수 있는 Agent로 현재 최고의 마작 AI로 알려져 있다. 이 Agent의 특징으로는

* 패 버림/쯔모/치/펑/깡/론 각각에 해당하는 신경망을 갖고 있다.
* 처음 학습할 때에는 모든 패를 공개한 상태에서 학습한다. Agent가 충분히 강해졌다고 생각했을 때, 패를 하나씩 비공개한다. 

'처음에는 공개, 충분히 강해졌으면 비공개'에서 영감을 받았다. OpenAgent와 ClosedAgent는 각각 공개/비공개에 해당된다. 그러나 비공개 했을 경우, 입력을 그에 맞춰서 수정해야하는 문제가 발생한다.

## 손패 예측
상대방의 패를 예측하는 것은 비공개 게임에서 아주 기본적인 전술이다. 마작에서도 마찬가지인데, 상대방의 공개된 정보(버린 패, 치/펑/깡)를 보고 상대방의 손패를 어느정도 예측할 수 있기 때문이다. 게다가 '후리텐'이 있는 일본마작인 경우, 상대방의 오름패를 견제할 수도 있기 때문에 패를 버리는 행위가 많은 정보를 포함한다. 이를 토대로 일부만 공개된 상태를 **복원**하는 **손패 예측기**를 고안하였다.

우선, OpenAgent의 알고리즘은 다음과 같다.
 > (턴 시작)--> 상태 변환 --(완전히 공개된 상태)--> [행동 선택기] --> (행동) 

 다음으로 ClosedAgent의 알고리즘은 다음과 같다.
 > (턴 시작)--> 상태 변환(불완전) --(일부만 공개된 상태)--> [손패 예측기] --(정제되지 않은 상태)--> 정제 --(복원된 상태)--> [행동 선택기] --> (행동)

 '정제'과정은 손패 예측기를 보조하는 역할을 한다. 이미 공개된 정보를 활용하여 손패 예측의 정확도를 올리고, OpenAgent와 공유하는 행동 선택기에 알맞은 형식으로 변환한다. 그러므로 손패 예측기는 행동 선택기와 독립적으로 존재하며, 다른 방식으로 학습한다. '정제'과정이 있기 때문에 손패 예측기의 출력은 '예측된 손패'를 확인할 수 있기만 한다면 어떠한 형태든 허용된다.

## 결론

* 마작은 비공개 정보 때문에 Monte Carlo 방식을 적용하기 어렵다.
* MS의 Suphx는 **Open, 그 다음 Closed** 전략을 사용하여 Agent를 강하게 만들었다.
* OpenAgent와 ClosedAgent의 간극을 메꾸기 위해 손패를 예측하는 부분을 추가하였다.
* '정제'과정을 통하여 상대방 손패 예측의 정확도를 올린다.
