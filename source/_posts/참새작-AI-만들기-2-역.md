---
title: 참새작 AI 만들기 2 - 역
toc: true
date: 2022-03-22 11:18:11
tags: [SuzumeAI, AI, Reinforcement Learning]
categories: [AI, Reinforcement Learning]
---

## 몸통
참새작에서 화료를 하려면 먼저 몸통 2세트를 만들어야 한다. 몸통의 종류는 다음과 같다.

* 슌쯔: 연속된 수패 3장
* 커쯔: 같은 패 3장

가장 이상적인 손패는 몸통이 앞 3개/뒷 3개로 나뉘는 경우이다. 그렇지 않는 경우가 있다.

> [1, 2, 3, 6, 6, 6] => [1, 2, 3], [6, 6, 6] : 이상적인 경우  
> [1, 1, 2, 2, 3, 3] => [1, 2, 3], [1, 2, 3] : 형태 O, 그러나 이상적이지 않다.

주로 이러한 '예외'는 커쯔에서 발생한다. 그러므로 커쯔를 잘 인식하도록 알고리즘을 잘 설계할 필요가 있다.

### 커쯔 인식
커쯔가 있는 경우와 그 커쯔의 index를 보면 다음과 같다.

```
[1, 2, 3, X, X, X] => index [0, 1, 2]
[1, 2, 2, 3, X, X] => index [0, 1, 3] (X)
[1, 2, 2, 2, 3, X] => index [0, 1, 4] (X)
[1, 2, 2, 2, 2, 3] => index [0, 1, 5]
[1, 1, 2, 3, X, X] => index [0, 2, 3] (X)
[1, 1, 2, 2, 3, X] => index [0, 2, 4]
[1, 1, 2, 2, 2, 3] => index [0, 2, 5] (X)
[1, 1, 1, 2, 3, X] => index [0, 3, 4] (X)
[1, 1, 1, 2, 2, 3] => index [0, 3, 5] (X)
[1, 1, 1, 1, 2, 3] => index [0, 4, 5]
```

어떠한 경우에도 화료 가능한 형태가 많들어지지 않은 경우에는 X로 표시하였다. 이를 통해 슌쯔를 검사하는 경우의 수를 줄이자면,

1. [0, 1, 2]
2. [0, 1, 5]
3. [0, 2, 4]
4. [0, 4, 5] : 커쯔-슌쯔 순으로 구성된 경우이므로, 실질적으로 1번과 같다.

이 세 경우만 살피면 된다. Score.split 함수는 위의 과정을 거쳐 몸통 2개를 분리한다. 다만, 이 함수에서는 패의 형태가 올바른지 확인하지는 않는다.

### 몸통의 정보
몸통도 역을 구하기 쉽도록 정보를 미리 처리할 수 있다. 역과 그에 해당하는 정보를 보자면,

* 슌쯔/커쯔
* 1/9/발/중의 포함여부 - 단요구, 찬타, 혼요구
* 적색, 녹색 패의 개수 - 적색 패, 녹일색, 적일색
* 도라의 개수

Score.count_triple 함수는 몸통을 인자로 받아 그 몸통의 정보를 반환하는 함수이다. 만약 몸통이 아니라면, Null에 해당하는 값을 반환한다. 이를 통해 손패가 형태를 갖추고 있는지 알 수 있다.

## 역
몸통의 정보를 얻었다면 이제 역을 구할 수 있다. 모든 역이 중첩이 되는 것은 아니다. 역의 중첩 규칙은 다음과 같다.

* 기본 역(슌쯔, 커쯔)는 반드시 중첩된다.
* 일반 역과 역만 역은 중첩되지 않으며, 역만 역을 선택한다.

그러므로 반드시 중첩되는 역부터 검사하는 것이 좋다. Hand의 point 함수는 위의 함수를 사용해서 몸통의 정보를 얻고, 그 정보를 활용해서 손패의 점수를 계산한다. 손패의 점수가 5점 이상이야 화료할 수 있기 때문에, 형태를 갖추지 않을 경우에는 0점으로 처리하여 점수만으로도 화료조건을 확인할 수 있도록 하였다.

## 결론
* 커쯔의 존재로 다양한 형태의 손패가 나올 수 있기 때문에, 커쯔를 중심으로 몸통을 인식하는 것이 좋다.
* 역을 인식하기 쉽게 하기 위해서, 몸통의 정보를 미리 계산하는 것이 좋다.